services:
  web:
    image: nginx:alpine
    restart: always

    labels:
      - "traefik.enable=true"

      # HTTP â†’ HTTPS redirect
      - "traefik.http.routers.web.entrypoints=http"
      - "traefik.http.routers.web.rule=Host(`dekomori.cc`)"
      - "traefik.http.middlewares.web-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.web.middlewares=web-https-redirect"

      # HTTPS router
      - "traefik.http.routers.web-secure.entrypoints=https"
      - "traefik.http.routers.web-secure.rule=Host(`dekomori.cc`)"
      - "traefik.http.routers.web-secure.tls=true"
      - "traefik.http.routers.web-secure.service=web"

      # Internal container port
      - "traefik.http.services.web.loadbalancer.server.port=80"

      # Traefik network
      - "traefik.docker.network=proxy"

    volumes:
      - .:/usr/share/nginx/html:ro

    networks:
      - proxy

networks:
  proxy:
    external: true

